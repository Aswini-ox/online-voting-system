<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Voting System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== BASE STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ========== CARD STYLES ========== */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* ========== HEADER & TYPOGRAPHY ========== */
        h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-align: center;
        }

        h2 {
            color: #444;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        h3 {
            color: #555;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .gradient-text {
            background: linear-gradient(135deg, #f5af19, #f12711);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(241, 39, 17, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(241, 39, 17, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #757575, #424242);
            color: white;
            box-shadow: 0 8px 20px rgba(117, 117, 117, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(117, 117, 117, 0.4);
        }

        .btn-large {
            padding: 18px 40px;
            font-size: 1.2rem;
            width: 100%;
            margin-top: 20px;
        }

        /* ========== INPUT FIELDS ========== */
        .input-group {
            position: relative;
            margin: 25px 0;
        }

        .input-group i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #f12711;
            font-size: 1.2rem;
        }

        .input-group input {
            width: 100%;
            padding: 18px 20px 18px 55px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .input-group input:focus {
            outline: none;
            border-color: #f5af19;
            box-shadow: 0 0 0 3px rgba(245, 175, 25, 0.2);
        }

        /* ========== CANDIDATE CARDS WITH IMAGES ========== */
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .candidate-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            border: 3px solid;
            border-image: linear-gradient(135deg, #f5af19, #f12711) 1;
            transition: all 0.4s ease;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .candidate-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(135deg, #f5af19, #f12711);
        }

        .candidate-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 20px 40px rgba(241, 39, 17, 0.2);
        }

        /* Candidate Image Container */
        .candidate-image-container {
            width: 160px;
            height: 160px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            background: linear-gradient(135deg, #f5af19, #f12711);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .candidate-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .candidate-card:hover .candidate-image {
            transform: scale(1.1);
        }

        /* Party Symbol */
        .party-symbol {
            position: absolute;
            bottom: -10px;
            right: -10px;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            border: 3px solid;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Party Colors */
        .party-democratic { color: #2196F3; border-color: #2196F3; }
        .party-republican { color: #F44336; border-color: #F44336; }
        .party-progressive { color: #4CAF50; border-color: #4CAF50; }
        .party-unity { color: #FF9800; border-color: #FF9800; }
        .party-tech { color: #9C27B0; border-color: #9C27B0; }
        .party-green { color: #00BCD4; border-color: #00BCD4; }
        .party-conservative { color: #795548; border-color: #795548; }
        .party-people { color: #FF5722; border-color: #FF5722; }

        .candidate-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .candidate-party {
            color: #f12711;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 6px 15px;
            background: rgba(241, 39, 17, 0.1);
            border-radius: 20px;
            display: inline-block;
        }

        .candidate-bio {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 0.95rem;
            min-height: 60px;
        }

        /* Candidate Stats */
        .candidate-stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            background: rgba(241, 39, 17, 0.05);
            padding: 10px;
            border-radius: 10px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .stat-item i {
            font-size: 1.2rem;
            color: #f12711;
        }

        .stat-item span {
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        /* ========== VOTE BUTTON ========== */
        .vote-btn {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.4s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(241, 39, 17, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .vote-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(241, 39, 17, 0.4);
        }

        .vote-btn:hover .btn-arrow {
            transform: translateX(5px);
        }

        .vote-btn:active {
            transform: scale(0.98);
        }

        .vote-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-arrow {
            transition: transform 0.3s ease;
        }

        /* ========== RESULTS DISPLAY ========== */
        .results-container {
            margin: 30px 0;
        }

        .result-item {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .progress-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #f5af19, #f12711);
            border-radius: 12px;
            width: 0%;
            transition: width 1.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ========== NAVIGATION ========== */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-tab.active {
            background: white;
            border-color: #f12711;
            color: #f12711;
            box-shadow: 0 5px 15px rgba(241, 39, 17, 0.2);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-3px);
        }

        /* ========== PAGE SECTIONS ========== */
        .page {
            display: none;
            animation: fadeIn 0.8s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========== SUMMARY SECTION ========== */
        .summary {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
            font-size: 1.1rem;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        /* ========== MESSAGES & LOADING ========== */
        .message {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            animation: slideIn 0.5s ease;
        }

        .message.success {
            background: rgba(76, 175, 80, 0.1);
            color: #2E7D32;
            border: 2px solid #4CAF50;
        }

        .message.error {
            background: rgba(241, 39, 17, 0.1);
            color: #f12711;
            border: 2px solid #f12711;
        }

        .message.info {
            background: rgba(33, 150, 243, 0.1);
            color: #2196F3;
            border: 2px solid #2196F3;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2rem;
        }

        .loading i {
            margin-right: 10px;
            color: #f12711;
        }

        /* ========== ACTION BUTTONS ========== */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 20px;
        }

        /* ========== VOTER INFO ========== */
        .voter-info {
            background: #f0f7ff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #2196F3;
        }

        .voter-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .status-voted {
            background: rgba(76, 175, 80, 0.1);
            color: #2E7D32;
        }

        .status-not-voted {
            background: rgba(241, 39, 17, 0.1);
            color: #f12711;
        }

        /* ========== ADMIN PANEL ========== */
        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .admin-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .admin-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .admin-icon {
            font-size: 3rem;
            color: #f12711;
            margin-bottom: 15px;
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 768px) {
            .card {
                padding: 25px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .candidates-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .input-group input {
                padding: 15px 15px 15px 50px;
                font-size: 1rem;
            }
            
            .candidate-image-container {
                width: 140px;
                height: 140px;
            }
        }

        /* ========== UTILITY CLASSES ========== */
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .hidden { display: none; }
        .flex { display: flex; }
        .flex-between { display: flex; justify-content: space-between; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .gap-20 { gap: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showPage('home')">
                <i class="fas fa-home"></i> Home
            </div>
            <div class="nav-tab" onclick="showPage('vote')">
                <i class="fas fa-vote-yea"></i> Vote Now
            </div>
            <div class="nav-tab" onclick="showPage('results')">
                <i class="fas fa-chart-bar"></i> Results
            </div>
            <div class="nav-tab" onclick="showPage('admin')">
                <i class="fas fa-user-shield"></i> Admin
            </div>
        </div>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <div class="card text-center">
                <h1><i class="fas fa-vote-yea"></i> Welcome to <span class="gradient-text">VoteSecure</span></h1>
                <p style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">
                    A secure, transparent, and easy-to-use online voting system
                </p>
                
                <div class="candidates-grid">
                    <div class="admin-card" onclick="showPage('vote')">
                        <div class="admin-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h3>Cast Your Vote</h3>
                        <p>Login with your voter ID and select your candidate</p>
                    </div>
                    
                    <div class="admin-card" onclick="showPage('results')">
                        <div class="admin-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Live Results</h3>
                        <p>Real-time election results as votes come in</p>
                    </div>
                    
                    <div class="admin-card" onclick="showPage('admin')">
                        <div class="admin-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Admin Panel</h3>
                        <p>Manage candidates and view system statistics</p>
                    </div>
                </div>
                
                <div class="mt-30">
                    <h2>System Status</h2>
                    <div id="system-status" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Checking backend connection...
                    </div>
                    
                    <button class="btn btn-primary btn-large" onclick="showPage('vote')">
                        <i class="fas fa-arrow-right"></i> Start Voting Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Voting Page -->
        <div id="vote-page" class="page">
            <div class="card">
                <h1><i class="fas fa-vote-yea"></i> Cast Your Vote</h1>
                
                <!-- Login Section -->
                <div id="login-section">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="voterId" placeholder="Enter Voter ID (e.g., VOTER001)" required>
                    </div>
                    
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Enter Password (any password for demo)" required>
                    </div>
                    
                    <button class="btn btn-primary btn-large" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Login to Vote
                    </button>
                    
                    <div class="text-center mt-20">
                        <p style="color: #666;">
                            <i class="fas fa-info-circle"></i> Demo Voters: VOTER001-VOTER100 (60 have voted)<br>
                            Use NEW IDs like TEST001 for new voters
                        </p>
                    </div>
                </div>
                
                <!-- Voting Section (Hidden Initially) -->
                <div id="voting-section" class="hidden">
                    <div class="voter-info">
                        <h2 id="welcome-message" class="gradient-text">Welcome, Voter!</h2>
                        <div id="voter-status-display">
                            <p>Checking your voting status...</p>
                        </div>
                    </div>
                    
                    <p style="margin-bottom: 20px; color: #666;">Select your candidate below:</p>
                    
                    <div id="candidates-list" class="candidates-grid">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading candidates with images...
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="showPage('results')">
                            <i class="fas fa-chart-bar"></i> View Live Results
                        </button>
                        <button class="btn btn-secondary" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Page -->
        <div id="results-page" class="page">
            <div class="card">
                <h1><i class="fas fa-chart-pie"></i> Live Election Results</h1>
                
                <div class="summary mb-30">
                    <div class="summary-item">
                        <span>Last Updated:</span>
                        <span id="last-updated">Just now</span>
                    </div>
                    <div class="summary-item">
                        <span>Total Votes:</span>
                        <span id="total-votes">0</span>
                    </div>
                    <div class="summary-item">
                        <span>Leading Candidate:</span>
                        <span id="leading-candidate" class="gradient-text">Loading...</span>
                    </div>
                </div>
                
                <div id="results-container">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Loading election results...
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="refreshResults()">
                        <i class="fas fa-sync-alt"></i> Refresh Results
                    </button>
                    <button class="btn btn-secondary" onclick="showPage('vote')">
                        <i class="fas fa-arrow-left"></i> Back to Voting
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="page">
            <div class="card">
                <h1><i class="fas fa-user-shield"></i> Admin Control Panel</h1>
                
                <!-- Admin Login -->
                <div id="admin-login">
                    <h2>Admin Authentication</h2>
                    <div class="input-group">
                        <i class="fas fa-user-cog"></i>
                        <input type="text" id="adminUser" placeholder="Admin Username" value="admin">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-key"></i>
                        <input type="password" id="adminPass" placeholder="Admin Password" value="admin123">
                    </div>
                    <button class="btn btn-primary btn-large" onclick="adminLogin()">
                        <i class="fas fa-lock"></i> Login as Admin
                    </button>
                    
                    <div class="text-center mt-20">
                        <p style="color: #666;">
                            <i class="fas fa-info-circle"></i> Demo Credentials: admin/admin123, supervisor/super123, manager/manager123
                        </p>
                    </div>
                </div>
                
                <!-- Admin Panel (Hidden Initially) -->
                <div id="admin-panel" class="hidden">
                    <div class="admin-controls">
                        <div class="admin-card" onclick="loadCandidatesForAdmin()">
                            <div class="admin-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>Manage Candidates</h3>
                            <p>Add, edit, or remove candidates</p>
                        </div>
                        
                        <div class="admin-card" onclick="loadVotersForAdmin()">
                            <div class="admin-icon">
                                <i class="fas fa-user-friends"></i>
                            </div>
                            <h3>View Voters</h3>
                            <p>See who has voted</p>
                        </div>
                        
                        <div class="admin-card" onclick="resetElection()">
                            <div class="admin-icon">
                                <i class="fas fa-redo"></i>
                            </div>
                            <h3>Reset Election</h3>
                            <p>Clear all votes and start fresh</p>
                        </div>
                        
                        <div class="admin-card" onclick="loadSystemStats()">
                            <div class="admin-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>System Stats</h3>
                            <p>View voting statistics</p>
                        </div>
                    </div>
                    
                    <!-- Admin Content Area -->
                    <div id="admin-content" class="mt-30">
                        <div class="loading">
                            <i class="fas fa-info-circle"></i> Select an option from above
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== GLOBAL VARIABLES ==========
      const API_BASE = 'https://blossomless-stefany-rancid.ngrok-free.dev/api';
        let currentVoter = null;
        let isAdmin = false;
        let adminToken = null;

        // ========== INITIALIZE APP ==========
        document.addEventListener('DOMContentLoaded', function() {
            checkBackendConnection();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Enter key for login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            // Enter key for admin login
            document.getElementById('adminPass').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') adminLogin();
            });
        }

        // ========== BACKEND CONNECTION ==========
        async function checkBackendConnection() {
            try {
                const response = await fetch(API_BASE + '/health');
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    document.getElementById('system-status').innerHTML = 
                        '<div class="message success"><i class="fas fa-check-circle"></i> Backend connected successfully!</div>';
                } else {
                    document.getElementById('system-status').innerHTML = 
                        '<div class="message error"><i class="fas fa-exclamation-triangle"></i> Backend has issues</div>';
                }
            } catch (error) {
                document.getElementById('system-status').innerHTML = 
                    '<div class="message error"><i class="fas fa-exclamation-triangle"></i> Cannot connect to backend. Make sure voting.py is running!</div>';
            }
        }

        // ========== PAGE NAVIGATION ==========
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(`${pageName}-page`).classList.add('active');
            
            // Activate corresponding tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.textContent.includes(pageName.charAt(0).toUpperCase() + pageName.slice(1)) || 
                    tab.textContent.includes('Home') && pageName === 'home') {
                    tab.classList.add('active');
                }
            });
            
            // Load page-specific content
            if (pageName === 'results') {
                loadResults();
            } else if (pageName === 'vote') {
                if (!currentVoter) {
                    document.getElementById('login-section').classList.remove('hidden');
                    document.getElementById('voting-section').classList.add('hidden');
                }
            } else if (pageName === 'admin') {
                if (!isAdmin) {
                    document.getElementById('admin-login').classList.remove('hidden');
                    document.getElementById('admin-panel').classList.add('hidden');
                }
            }
        }

        // ========== HELPER FUNCTIONS ==========
        function getPartyIcon(partyName) {
            const icons = {
                'democratic': 'democrat',
                'republican': 'republican',
                'progressive': 'leaf',
                'unity': 'handshake',
                'tech': 'laptop-code',
                'green': 'tree',
                'conservative': 'shield-alt',
                'people': 'users'
            };
            
            const key = partyName.toLowerCase().split(' ')[0];
            return icons[key] || 'flag';
        }

        function getPartyClass(partyName) {
            const classes = {
                'democratic': 'party-democratic',
                'republican': 'party-republican',
                'progressive': 'party-progressive',
                'unity': 'party-unity',
                'tech': 'party-tech',
                'green': 'party-green',
                'conservative': 'party-conservative',
                'people': 'party-people'
            };
            
            const key = partyName.toLowerCase().split(' ')[0];
            return classes[key] || 'party-democratic';
        }

        // ========== VOTER FUNCTIONS ==========
        async function login() {
            const voterId = document.getElementById('voterId').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!voterId) {
                showMessage('Please enter a Voter ID', 'error');
                return;
            }
            
            showMessage('Checking voter status...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/voter/${voterId}`);
                const voter = await response.json();
                
                if (voter.has_voted) {
                    showMessage('This voter has already voted! Try a new ID like TEST001', 'error');
                    return;
                }
                
                currentVoter = voter;
                
                document.getElementById('welcome-message').innerHTML = 
                    `Welcome, <span class="gradient-text">${voterId}</span>!`;
                
                document.getElementById('voter-status-display').innerHTML = `
                    <div class="flex-between">
                        <span>Voter ID: <strong>${voterId}</strong></span>
                        <span class="voter-status status-not-voted">NOT VOTED</span>
                    </div>
                `;
                
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('voting-section').classList.remove('hidden');
                
                loadCandidatesForVoting();
                
                showMessage('Login successful! Please select your candidate.', 'success');
                
            } catch (error) {
                showMessage('Error connecting to server. Make sure backend is running!', 'error');
                console.error('Login error:', error);
            }
        }

        async function loadCandidatesForVoting() {
            const container = document.getElementById('candidates-list');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading candidates with images...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/candidates`);
                const candidates = await response.json();
                
                if (candidates.length === 0) {
                    container.innerHTML = '<div class="message info">No candidates available.</div>';
                    return;
                }
                
                // Get total votes for percentage calculation
                const totalVotes = candidates.reduce((sum, c) => sum + c.votes, 0);
                
                container.innerHTML = '';
                
                candidates.forEach(candidate => {
                    const partyClass = getPartyClass(candidate.party);
                    const partyIcon = getPartyIcon(candidate.party);
                    const percentage = totalVotes > 0 ? ((candidate.votes / totalVotes) * 100).toFixed(1) : 0;
                    
                    const card = document.createElement('div');
                    card.className = 'candidate-card';
                    card.innerHTML = `
                        <div class="candidate-image-container">
                            ${candidate.image_url ? 
                                `<img src="${candidate.image_url}" alt="${candidate.name}" class="candidate-image" 
                                     onerror="this.onerror=null; this.parentElement.innerHTML='<div style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;\">${candidate.avatar || 'ðŸ‘¤'}</div>';">` : 
                                `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;color:white;">
                                    ${candidate.avatar || 'ðŸ‘¤'}
                                </div>`
                            }
                            <div class="party-symbol ${partyClass}">
                                <i class="fas fa-${partyIcon}"></i>
                            </div>
                        </div>
                        
                        <h3 class="candidate-name">${candidate.name}</h3>
                        <div class="candidate-party">
                            <i class="fas fa-flag"></i> ${candidate.party}
                        </div>
                        
                        <div class="candidate-stats">
                            <div class="stat-item">
                                <i class="fas fa-chart-line"></i>
                                <span>${candidate.votes} votes</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-percentage"></i>
                                <span>${percentage}%</span>
                            </div>
                        </div>
                        
                        <p class="candidate-bio">${candidate.bio || 'No biography available'}</p>
                        
                        <button class="vote-btn" onclick="castVote(${candidate.id})" data-id="${candidate.id}">
                            <i class="fas fa-vote-yea"></i>
                            <span class="btn-text">Vote for ${candidate.name.split(' ')[0]}</span>
                            <i class="fas fa-arrow-right btn-arrow"></i>
                        </button>
                    `;
                    container.appendChild(card);
                });
                
            } catch (error) {
                container.innerHTML = '<div class="message error">Failed to load candidates. Check backend connection.</div>';
                console.error('Load candidates error:', error);
            }
        }

        async function castVote(candidateId) {
            if (!currentVoter) {
                showMessage('Please login first!', 'error');
                return;
            }
            
            document.querySelectorAll('.vote-btn').forEach(btn => {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            });
            
            try {
                const response = await fetch(`${API_BASE}/vote`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        candidate_id: candidateId,
                        voter_id: currentVoter.id 
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage(`âœ… Your vote has been recorded for ${result.candidate.name}!`, 'success');
                    
                    document.getElementById('voter-status-display').innerHTML = `
                        <div class="flex-between">
                            <span>Voter ID: <strong>${currentVoter.id}</strong></span>
                            <span class="voter-status status-voted">VOTED âœ“</span>
                        </div>
                    `;
                    
                    document.querySelectorAll('.vote-btn').forEach(btn => {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-check-circle"></i> Already Voted';
                    });
                    
                    setTimeout(() => {
                        showPage('results');
                    }, 2000);
                    
                } else {
                    showMessage(`Error: ${result.error}`, 'error');
                    
                    document.querySelectorAll('.vote-btn').forEach(btn => {
                        btn.disabled = false;
                        btn.innerHTML = `<i class="fas fa-vote-yea"></i><span class="btn-text">Vote</span><i class="fas fa-arrow-right btn-arrow"></i>`;
                    });
                }
                
            } catch (error) {
                showMessage('Failed to submit vote. Check server connection.', 'error');
                console.error('Vote error:', error);
                
                document.querySelectorAll('.vote-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.innerHTML = `<i class="fas fa-vote-yea"></i><span class="btn-text">Vote</span><i class="fas fa-arrow-right btn-arrow"></i>`;
                });
            }
        }

        function logout() {
            currentVoter = null;
            document.getElementById('voterId').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('voting-section').classList.add('hidden');
            showMessage('You have been logged out.', 'info');
        }

        // ========== RESULTS FUNCTIONS ==========
        async function loadResults() {
            const container = document.getElementById('results-container');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading election results...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/results`);
                const data = await response.json();
                
                document.getElementById('total-votes').textContent = data.summary.total_votes;
                document.getElementById('leading-candidate').textContent = data.summary.leading_candidate;
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
                
                container.innerHTML = '';
                
                if (data.candidates.length === 0) {
                    container.innerHTML = '<div class="message info">No votes yet.</div>';
                    return;
                }
                
                data.candidates.forEach(candidate => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    resultItem.innerHTML = `
                        <div class="result-header">
                            <span class="candidate-name">${candidate.name}</span>
                            <span class="vote-count">${candidate.votes} votes (${candidate.percentage}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${candidate.percentage}%; background: linear-gradient(135deg, ${candidate.color}, ${darkenColor(candidate.color, 20)});"></div>
                        </div>
                        <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                            ${candidate.party} â€¢ ${candidate.bio || ''}
                        </div>
                    `;
                    container.appendChild(resultItem);
                });
                
                setTimeout(() => {
                    document.querySelectorAll('.progress-fill').forEach(bar => {
                        const width = bar.style.width;
                        bar.style.width = '0';
                        setTimeout(() => {
                            bar.style.width = width;
                        }, 100);
                    });
                }, 300);
                
            } catch (error) {
                container.innerHTML = '<div class="message error">Failed to load results. Check backend connection.</div>';
                console.error('Load results error:', error);
            }
        }

        function refreshResults() {
            loadResults();
            showMessage('Results refreshed!', 'success');
        }

        // ========== ADMIN FUNCTIONS ==========
        async function adminLogin() {
            const username = document.getElementById('adminUser').value;
            const password = document.getElementById('adminPass').value;
            
            if (!username || !password) {
                showMessage('Please enter admin credentials', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        username: username,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    isAdmin = true;
                    adminToken = result.token;
                    
                    document.getElementById('admin-login').classList.add('hidden');
                    document.getElementById('admin-panel').classList.remove('hidden');
                    
                    showMessage('Admin login successful!', 'success');
                    loadSystemStats();
                    
                } else {
                    showMessage('Invalid admin credentials', 'error');
                }
                
            } catch (error) {
                showMessage('Failed to connect to admin API', 'error');
                console.error('Admin login error:', error);
            }
        }

        async function loadSystemStats() {
            const container = document.getElementById('admin-content');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading system statistics...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const stats = await response.json();
                
                container.innerHTML = `
                    <h2><i class="fas fa-chart-line"></i> System Statistics</h2>
                    <div class="summary mt-20">
                        <div class="summary-item">
                            <span>Total Candidates:</span>
                            <span>${stats.statistics.candidates}</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Voters:</span>
                            <span>${stats.statistics.voters}</span>
                        </div>
                        <div class="summary-item">
                            <span>Total Votes:</span>
                            <span>${stats.statistics.total_votes}</span>
                        </div>
                        <div class="summary-item">
                            <span>Voters Voted:</span>
                            <span>${stats.statistics.voters_voted} (${stats.statistics.voting_rate}%)</span>
                        </div>
                        <div class="summary-item">
                            <span>Most Active Hour:</span>
                            <span>${stats.statistics.most_active_hour}:00</span>
                        </div>
                    </div>
                    <div class="text-center mt-30">
                        <button class="btn btn-primary" onclick="loadSystemStats()">
                            <i class="fas fa-sync-alt"></i> Refresh Stats
                        </button>
                    </div>
                `;
                
            } catch (error) {
                container.innerHTML = '<div class="message error">Failed to load system stats.</div>';
                console.error('Load stats error:', error);
            }
        }

        async function loadCandidatesForAdmin() {
            const container = document.getElementById('admin-content');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading candidates...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/candidates`);
                const candidates = await response.json();
                
                let html = `
                    <h2><i class="fas fa-users"></i> Manage Candidates</h2>
                    <div class="candidates-grid mt-20">
                `;
                
                candidates.forEach(candidate => {
                    const partyClass = getPartyClass(candidate.party);
                    const percentage = ((candidate.votes / candidates.reduce((sum, c) => sum + c.votes, 0)) * 100 || 0).toFixed(1);
                    
                    html += `
                        <div class="candidate-card">
                            <div class="candidate-image-container">
                                ${candidate.image_url ? 
                                    `<img src="${candidate.image_url}" alt="${candidate.name}" class="candidate-image">` : 
                                    `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;color:white;">
                                        ${candidate.avatar || 'ðŸ‘¤'}
                                    </div>`
                                }
                                <div class="party-symbol ${partyClass}">
                                    <i class="fas fa-${getPartyIcon(candidate.party)}"></i>
                                </div>
                            </div>
                            <h3 class="candidate-name">${candidate.name}</h3>
                            <div class="candidate-party">${candidate.party}</div>
                            <div class="candidate-stats">
                                <div class="stat-item">
                                    <i class="fas fa-chart-line"></i>
                                    <span>${candidate.votes} votes</span>
                                </div>
                                <div class="stat-item">
                                    <i class="fas fa-percentage"></i>
                                    <span>${percentage}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    </div>
                    <div class="mt-30">
                        <h3>Add New Candidate</h3>
                        <div class="input-group">
                            <i class="fas fa-user-tie"></i>
                            <input type="text" id="newCandidateName" placeholder="Candidate Name">
                        </div>
                        <div class="input-group">
                            <i class="fas fa-flag"></i>
                            <input type="text" id="newCandidateParty" placeholder="Political Party">
                        </div>
                        <div class="input-group">
                            <i class="fas fa-image"></i>
                            <input type="text" id="newCandidateImage" placeholder="Image URL (optional)">
                        </div>
                        <button class="btn btn-success" onclick="addCandidate()">
                            <i class="fas fa-plus"></i> Add Candidate
                        </button>
                    </div>
                `;
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = '<div class="message error">Failed to load candidates.</div>';
                console.error('Load candidates admin error:', error);
            }
        }

        async function addCandidate() {
            const name = document.getElementById('newCandidateName').value.trim();
            const party = document.getElementById('newCandidateParty').value.trim();
            const imageUrl = document.getElementById('newCandidateImage').value.trim();
            
            if (!name || !party) {
                showMessage('Please enter candidate name and party', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/candidates`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        name: name,
                        party: party,
                        bio: 'New candidate added via admin panel',
                        color: '#FF6B6B',
                        avatar: 'ðŸ‘¤',
                        image_url: imageUrl || null
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(`Candidate "${name}" added successfully!`, 'success');
                    loadCandidatesForAdmin();
                } else {
                    showMessage(`Error: ${result.error}`, 'error');
                }
                
            } catch (error) {
                showMessage('Failed to add candidate', 'error');
                console.error('Add candidate error:', error);
            }
        }

        async function loadVotersForAdmin() {
            const container = document.getElementById('admin-content');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading voters...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/voters`);
                const voters = await response.json();
                
                let html = `
                    <h2><i class="fas fa-user-friends"></i> Voter List (${voters.length} voters)</h2>
                    <div style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
                `;
                
                voters.forEach(voter => {
                    html += `
                        <div class="summary-item" style="background: ${voter.has_voted ? '#f0fff0' : '#fff0f0'};">
                            <span>${voter.id} - ${voter.name}</span>
                            <span class="voter-status ${voter.has_voted ? 'status-voted' : 'status-not-voted'}">
                                ${voter.has_voted ? 'VOTED' : 'NOT VOTED'}
                            </span>
                        </div>
                    `;
                });
                
                html += `</div>`;
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = '<div class="message error">Failed to load voters.</div>';
                console.error('Load voters error:', error);
            }
        }

        async function resetElection() {
            if (!confirm('âš ï¸ Are you sure? This will reset ALL votes and cannot be undone!')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/reset`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        type: 'votes'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    loadSystemStats();
                    loadResults();
                } else {
                    showMessage(`Error: ${result.error}`, 'error');
                }
                
            } catch (error) {
                showMessage('Failed to reset election', 'error');
                console.error('Reset election error:', error);
            }
        }

        // ========== UTILITY FUNCTIONS ==========
        function showMessage(text, type) {
            const existingMsg = document.querySelector('.message');
            if (existingMsg) existingMsg.remove();
            
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${text}`;
            
            const container = document.querySelector('.container');
            container.insertBefore(message, container.firstChild);
            
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 5000);
        }

        function darkenColor(color, percent) {
            let r = parseInt(color.substring(1,3),16);
            let g = parseInt(color.substring(3,5),16);
            let b = parseInt(color.substring(5,7),16);

            r = parseInt(r * (100 - percent) / 100);
            g = parseInt(g * (100 - percent) / 100);
            b = parseInt(b * (100 - percent) / 100);

            r = (r<255)?r:255;  
            g = (g<255)?g:255;  
            b = (b<255)?b:255;  

            const rr = r.toString(16).padStart(2, '0');
            const gg = g.toString(16).padStart(2, '0');
            const bb = b.toString(16).padStart(2, '0');

            return "#" + rr + gg + bb;
        }
    </script>
</body>
</html>